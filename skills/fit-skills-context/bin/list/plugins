#!/usr/bin/env bash
# List all skills and commands from installed plugins
# Output: path|type|name (one per line)

set -e

# Structure: ~/.claude/plugins/cache/marketplace/plugin/version/...
[ -d "$HOME/.claude/plugins/cache" ] || exit 0

bin_dir="$(cd "$(dirname "$0")/.." && pwd)"

for marketplace in "$HOME/.claude/plugins/cache"/*/; do
  [ -d "$marketplace" ] || continue
  for plugin in "$marketplace"/*/; do
    [ -d "$plugin" ] || continue

    # Get latest version (sort by semver, take last)
    latest=$(ls -1 "$plugin" | sort -t. -k1,1n -k2,2n -k3,3n | tail -1)
    [ -n "$latest" ] || continue
    version="${plugin}${latest}/"

    "$bin_dir/scan-skills" "${version}skills"
    "$bin_dir/scan-commands" "${version}commands"
  done
done
