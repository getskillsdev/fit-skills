#!/usr/bin/env bash
# Scan a directory for skill .md files
# Usage: scan-skills <dir>
# Output: path|skill|name (one per line)

set -e

dir="${1:?Usage: scan-skills <dir>}"
[ -d "$dir" ] || exit 0

# Find SKILL.md files (directory-style skills, case-insensitive)
while IFS= read -r f; do
  # Skip bin/ directories (helper scripts, not skills)
  [[ "$f" == */bin/* ]] && continue
  name=$(basename "$(dirname "$f")")
  echo "$f|skill|$name"
done < <(find -L "$dir" -iname "SKILL.md" -type f 2>/dev/null)

# Find flat .md files directly in skills/ (not in subdirs, not SKILL.md)
for f in "$dir"/*.md; do
  [ -f "$f" ] || continue
  base=$(basename "$f" .md)
  [[ "$base" == "SKILL" || "$base" == "skill" ]] && continue
  echo "$f|skill|$base"
done
